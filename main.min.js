$(function(){"use strict";var t,e=window.chimera;t=new Phaser.Game(640,480,Phaser.CANVAS,"chimera-game"),t.state.add("boot",e.Boot),t.state.add("preloader",e.Preloader),t.state.add("game",e.Game);var i=!1,s=function(){i||(i=!0,$(window).unbind("keypress"),$("#intro").fadeOut(500,function(){t.state.start("boot")}))};setTimeout(s,25e3),$(window).keypress(function(t){32==t.keyCode&&s()})}),function(){"use strict";function t(){}t.prototype={preload:function(){this.load.image("preloader","assets/preloader.gif")},create:function(){this.game.input.maxPointers=1,this.game.device.desktop?this.game.scale.pageAlignHorizontally=!0:(this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.minWidth=480,this.game.scale.minHeight=260,this.game.scale.maxWidth=640,this.game.scale.maxHeight=480,this.game.scale.forceOrientation(!0),this.game.scale.pageAlignHorizontally=!0,this.game.scale.setScreenSize(!0)),this.game.state.start("preloader")}},window.chimera=window.chimera||{},window.chimera.Boot=t}(),function(){"use strict";function t(){}t.prototype={create:function(){this.randSeed=Date.now(),this.score=0,this.style={font:"16px nasalization",fill:"#FFFFFF",align:"center"},this.bg=this.add.sprite(0,0,"bg"),this.bg.scale.set(.5,.5),this.cursors=this.game.input.keyboard.createCursorKeys(),this.game.input.mouse.mouseWheelCallback=this.mouseMovePlayer.bind(this),this.target={x:1.1*this.game.width,y:this.game.height/2},this.earth=this.add.sprite(1.72*this.game.width,.5*this.game.height,"earth"),this.earth.anchor.setTo(.5,.5),this.earth.r=.5*this.earth.width,this.bottomRightAngle=180*this.game.physics.arcade.angleToXY(this.earth,this.game.width,this.game.height)/Math.PI,this.mocha=this.add.sprite(0,.5*this.game.height,"mocha"),this.mocha.anchor.setTo(.5,.5),this.mocha.angle=90,this.cannon=this.add.sprite(0,0,"cannon"),this.cannon.position.x=.45*this.mocha.height,this.cannon.position.y=.5*this.game.height,this.cannon.scale.set(.25,.25),this.cannon.anchor.set(.5,1.2),this.cannon.r=.5*this.cannon.width,this.pinpoints=this.game.add.group(),this.pums=this.game.add.group(),this.sounds={soundtrack:this.game.add.audio("soundtrack",.05,!0),actions:{fire:this.game.add.audio("fire"),hit:this.game.add.audio("hit"),earth_hit:this.game.add.audio("earth_hit"),junk_hit:this.game.add.audio("junk_hit"),miss:this.game.add.audio("miss"),new_pin:this.game.add.audio("new_pin"),ship_hit:this.game.add.audio("ship_hit")}};for(var t=3,e=0;t>e;e++)this.game.time.events.add(5*Phaser.Timer.SECOND*e,this.newPin,this);this.earth.addChild(this.pinpoints),this.earth.addChild(this.pums),this.keyShoot=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.keyShoot.onDown.add(this.fire,this),this.lineProperties=this.add.bitmapData(this.game.width,this.game.height),this.lineProperties.ctx.beginPath(),this.lineProperties.ctx.lineWidth="2",this.lineProperties.ctx.setLineDash([2,15]),this.lineProperties.ctx.strokeStyle="rgba(255, 255, 255, 0.5)",this.lineProperties.ctx.stroke(),this.line=this.add.sprite(0,0,this.lineProperties),this.trajectoryLine(),this.sounds.soundtrack.play(),this.game.world.bringToTop(this.mocha),this.game.world.bringToTop(this.earth),this.textSprite=this.game.add.text(20,10,"PLANET MOCHA",this.style),this.textSprite=this.game.add.text(20,30,"SCORE: 0",this.style),this.game.time.events.loop(Phaser.Timer.SECOND,this.maybeGenJunk,this)},genPinPointAngle:function(){var t=null;for(this.pinAngles=this.pinAngles||{};null===t;)t=5*Math.floor((Math.floor(5*this.random(1,4)+153)-this.earth.angle)/5),this.pinAngles[t]?t=null:this.pinAngles[t]=!0;return t},update:function(){this.coffee&&this.coffee.exists?this.steerCoffee():this.steerCannon(),this.earth.angle=8e-5*this.game.time.now*(180/Math.PI),this.trajectoryLine(),this.movePlayer(),this.checkCoffeeCollision(),this.updateCoffeeSpeed(),this.drawScore()},checkOutOfBoundsPins:function(){this.pinpoints.forEach(function(t){var e=t.angle+this.earth.angle;e>195&&100>e&&this.renewPin(this.pinpoints.getIndex(t))},this)},drawScore:function(){this.textSprite.text="SCORE: "+this.score},fire:function(){this.coffee&&this.coffee.exists||(this.coffee=this.add.sprite(this.cannonTip().x,this.cannonTip().y,"coffee"),this.coffee.checkWorldBounds=!0,this.coffee.anchor.set(.5,.5),this.coffee.scale.set(.2,.2),this.coffee.hit=!1,this.game.physics.arcade.enable(this.coffee),this.coffee.events.onOutOfBounds.add(function(){this.line.visible=!0,this.playFx(this.sounds.actions.miss)},this),this.coffeeFlame=this.add.sprite(0,0,"flames"),this.coffee.addChild(this.coffeeFlame),this.coffeeFlame.anchor.set(1.3,.5),this.coffeeFlame.animations.add("walk"),this.coffeeFlame.animations.play("walk",10,!0),this.coffee.outOfBoundsKill=!0,this.coffee.angle=this.cannon.angle-90,this.updateCoffeeSpeed(),this.playFx(this.sounds.actions.fire),this.line.visible=!1)},updateCoffeeSpeed:function(){if(this.coffee&&this.coffee.body){var t=200;this.coffee.body.velocity.x=t*Math.cos(this.coffee.angle*Math.PI/180),this.coffee.body.velocity.y=t*Math.sin(this.coffee.angle*Math.PI/180)}},playFx:function(t){t.play()},trajectoryLine:function(){this.lineProperties.clear(),this.lineProperties.ctx.beginPath(),this.lineProperties.ctx.moveTo(this.cannonTip().x,this.cannonTip().y),this.lineProperties.ctx.lineTo(this.target.x,this.target.y),this.lineProperties.ctx.stroke(),this.lineProperties.ctx.closePath(),this.lineProperties.render()},cannonTip:function(){return{x:this.cannon.world.x+Math.sin(this.cannon.angle*Math.PI/180)*this.cannon.height*1.2,y:this.cannon.world.y-Math.cos(this.cannon.angle*Math.PI/180)*this.cannon.width*1.2}},movePlayer:function(){var t=6,e=60;this.cursors.down.isDown&&this.target.y<this.earth.y+this.earth.height/2+e&&(this.target.y+=t),this.cursors.up.isDown&&this.target.y>this.earth.y-this.earth.height/2-e&&(this.target.y-=t)},mouseMovePlayer:function(){var t=20,e=60;this.game.input.mouse.wheelDelta===Phaser.Mouse.WHEEL_UP?this.target.y<this.earth.y+this.earth.height/2+e&&(this.target.y-=t):this.target.y>this.earth.y-this.earth.height/2-e&&(this.target.y+=t)},steerCannon:function(){var t=Math.atan2(this.target.y-this.cannon.y,this.target.x-this.cannon.x);t*=180/Math.PI,0>t&&(t=360- -t),this.cannon.angle=90+t},steerCoffee:function(){var t=1.5;this.cursors.down.isDown&&(this.coffee.angle+=t,this.coffee.lastSteeredAt=Date.now()),this.cursors.up.isDown&&(this.coffee.angle-=t,this.coffee.lastSteeredAt=Date.now()),this.coffee.angle<-50?this.coffee.angle=-50:this.coffee.angle>50&&(this.coffee.angle=50),this.updateCoffeeSpeed()},maybeGenJunk:function(){var t=80;if(this.random(1,100)<t){this.junks=this.junks||this.game.add.group();var e={},i={},s=this.random(0,1);e.x=this.random(.2*this.game.width,.8*this.game.width),i.x=this.random(.2*this.game.width,.8*this.game.width),0==s?(e.y=-50,i.y=this.game.height+0):1==s&&(e.y=this.game.height+0,i.y=-50);var a,t=this.random(1,30);if(25>t)a=this.random(0,1)<1?this.add.sprite(e.x,e.y,"commet"):this.add.sprite(e.x,e.y,"commet-purple"),a.animations.add("walk"),a.animations.play("walk",10,!0),a.r=.08*a.width,this.junks.add(a),a.anchor.set(.5,.5),a.scale.set(.15,.15);else{a=this.add.sprite(e.x,e.y,"ship");var h=this.add.sprite(0,0,"shipFlame");h.animations.add("walk"),h.animations.play("walk",10,!0),a.addChild(h),h.scale.set(.3,.5),h.anchor.set(-.45,.5),a.r=.3*a.width,this.junks.add(a),a.anchor.set(.5,.5),a.scale.set(.7,.7)}a.outOfBoundsKill=!0,this.game.physics.enable(a,Phaser.Physics.ARCADE),a.rotation=this.game.physics.arcade.moveToXY(a,i.x,i.y,60)+Math.PI}},random:function(t,e){this.randSeed=this.randSeed+1;var i=this.randSeed,s=function(){var t=1e4*Math.sin(i++);return t-Math.floor(t)},a=Math.floor(s()*(e-t+1))+t;return a},checkCoffeeCollision:function(){if(this.coffee&&this.coffee.exists&&(this.junks&&this.junks.forEach(function(t){if(!t.notCollidable&&this.circlesOverlap(this.coffee,t)){this.coffee.kill(),this.line.visible=!0,t.body.velocity.x=0,t.body.velocity.y=0,t.scale.set(1,1),t.rotation=.25,t.tween?t.tween.stop():t.body.angularVelocity=0,"ship"===t.key?(this.playFx(this.sounds.actions.ship_hit),this.score-=1):(this.playFx(this.sounds.actions.junk_hit),this.score-=1),t.r=void 0,t.kill();var e=this.game.add.emitter(0,0,1e3);e.makeParticles(["red","orange","yellow"]),e.x=t.x,e.y=t.y,e.start(!0,2e3,1,20,20),t.notCollidable=!0,t.children.forEach(function(t){t.kill()}),t.scale.set(.2,.2),t.tween=this.add.tween(t).to({alpha:0},1e3,Phaser.Easing.Quadratic.InOut),t.tween.start(),this.timer=this.game.time.create(this.game),this.timer.add(1e3,function(){this.junks.remove(t),t.destroy(),e.destroy()},this),this.timer.start()}},this),this.circlesOverlap(this.earth,this.coffee))){if(this.coffee.hit)return;var t=null,e=-1;this.pinpoints.forEach(function(i){if(this.circlesOverlap(this.coffee,i)){var s=this.pinpoints.getIndex(i),a=this.centerDists(this.coffee,i);(!t||t>a)&&(t=a,e=s)}},this),-1===e?(this.score-=1,this.playFx(this.sounds.actions.earth_hit)):(this.pums.getChildAt(e).visible=!0,this.pinpoints.getChildAt(e).visible=!1,this.coffee.hit=!0,this.playFx(this.sounds.actions.hit),this.score+=5,this.game.time.events.add(Phaser.Timer.SECOND,function(){this.renewPin(e)}.bind(this),this)),this.coffee.kill(),this.line.visible=!0}},newPin:function(){var t=this.pinpoints.create(0,0,"pinpoint"),e=this.pums.create(0,0,"smile");t.startAngle=this.genPinPointAngle(),t.angle=t.startAngle,t.r=15,e.angle=t.angle,t.scale={x:.8,y:.8},t.anchor={x:.2,y:.5},e.anchor={x:0,y:.5},e.scale={x:.8,y:.8},e.visible=!1,this.pinpoints.add(t),this.pums.add(e),t.x=.497*this.earth.width*Math.cos(t.angle*Math.PI/180),t.y=.497*this.earth.width*Math.sin(t.angle*Math.PI/180),e.x=.497*(this.earth.width+10)*Math.cos(e.angle*Math.PI/180),e.y=.497*(this.earth.width+10)*Math.sin(e.angle*Math.PI/180),t.enableBody=!0,t.checkWorldBounds=!0,t.outOfBoundsKill=!0,t.events.onOutOfBounds.add(function(){t.out||(t.out=!0,delete this.pinAngles[t.startAngle],this.score-=1,this.newPin())},this),this.playFx(this.sounds.actions.new_pin)},renewPin:function(t){var e=this.pinpoints.getChildAt(t),i=this.pums.getChildAt(t);e.kill(),delete this.pinAngles[e.startAngle],this.pinpoints.remove(e),i.kill(),this.pums.remove(i),this.game.time.events.add(2*Phaser.Timer.SECOND,this.newPin,this)},circlesOverlap:function(t,e){var i=Math.sqrt(Math.pow(t.world.x-e.world.x,2)+Math.pow(t.world.y-e.world.y,2));return i<Math.max(t.r||t.width,e.r||e.width)},centerDists:function(t,e){return Math.sqrt(Math.pow(t.world.x-e.world.x,2)+Math.pow(e.world.y-e.world.y,2))}},window.chimera=window.chimera||{},window.chimera.Game=t}(),function(){"use strict";function t(){this.asset=null,this.ready=!1}t.prototype={preload:function(){this.asset=this.add.sprite(.5*this.game.width-110,.5*this.game.height-10,"preloader"),this.load.onLoadComplete.addOnce(this.onLoadComplete,this),this.load.setPreloadSprite(this.asset),this.loadResources()},loadResources:function(){this.load.image("earth","assets/earth.svg"),this.load.image("mocha","assets/mocha.svg"),this.load.image("coffee","assets/coffee.png"),this.load.image("cannon","assets/cannon.png"),this.load.image("pinpoint","assets/location.png"),this.load.image("pum","assets/explode.png"),this.load.image("bg","assets/background.png"),this.load.image("smile","assets/success.png"),this.load.image("ship","assets/ship.svg"),this.load.image("red","assets/red.png"),this.load.image("orange","assets/orange.png"),this.load.image("yellow","assets/yellow.png"),this.load.spritesheet("shipFlame","assets/ship-flame.png",216,72,3),this.load.spritesheet("flames","assets/flames.png",62,36,3),this.load.spritesheet("commet","assets/comet-flame.png",262,127,3),this.load.spritesheet("commet-purple","assets/comet-flame-purple.png",262,127,3),this.loadSounds(["fire","hit","earth_hit","junk_hit","miss","new_pin","soundtrack","ship_hit"])},loadSounds:function(t){t.forEach(function(t){this.load.audio(t,"assets/audio/"+t+".mp3")},this)},create:function(){this.asset.cropEnabled=!1},update:function(){this.ready&&this.game.state.start("game")},onLoadComplete:function(){this.ready=!0}},window.chimera=window.chimera||{},window.chimera.Preloader=t}(),function(){"use strict";function t(){}t.prototype={create:function(){},update:function(){}},window.chimera=window.chimera||{},window.chimera.Story=t}();